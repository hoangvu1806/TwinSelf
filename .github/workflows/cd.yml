name: CD - Deploy to Production

on:
    workflow_run:
        workflows: ["CI Pipeline"]
        types:
            - completed
        branches: [main]
    workflow_dispatch:

jobs:
    deploy:
        runs-on: self-hosted
        timeout-minutes: 15
        if: ${{ github.event.workflow_run.conclusion == 'success' || github.event_name == 'workflow_dispatch' }}

        steps:
            - name: Deploy to production
              run: |
                  Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass -Force
                  D:\HOANGVU\VPS\TwinSelf\deploy.ps1
